## 인스타그램으로 알아보는 데이터 구조 설계

<DB설계>

테이블 , 엔터티(개체) 등등 다행이 이번학기에 데이터베이스 수업을 수강신청해놔서

배우는내용들이 겹쳐서 더 잘 이해 할 수 있을거같다.

인스타그램의 큰 틀을 보고 데이터가 어떻게 구성되는지 생각해보자.


- 회원정보
    - 이름
    - 에미엘
    - 유저ID
    - 비밀번호
    - 회원가입일
    - 내가 쓴 게시글들
    - 나를 팔로워하는 유저들
    - 내가 팔로잉하는 유저들

- 프로필 정보
    - 프로필 사진
    - 프로필 설명
    - 프로필 사진 업로드일

- 게시글 정보
    - 제목
    - 본문
    - 게시글 수정일
    - 게시글 작성일
    - 작성자
    - 댓글들

- ~~태그~~
    - ~~태그 이름~~
    - ~~태그 작성자~~
    - ~~게시글 정보~~

- 댓글 정보
    - 작성자
    - 댓글을 단 게시글
    - 댓글
    - 댓글 작성일
    - 댓글 수정일


테이블에서 엑셀시트를 생각하면 편하다.

컬럼(세로)과 로우(가로)

필드와 레코드 라고 할수있다.

pymongo를 사용할적에

막 넣어도 다 저장해버리는 일관성없는 데이터베이스를 사용했엇다.

RDBMS 라는녀석이 있다.

SQL = ~~search~~ query language

    = structured query language

서치 쿼리가 아니였다..

구조화 질의어의 약자인데


___

정보 = 요구에 의한 , 필요에 의한 정제된 데이터들

데이터 = 특정 조건이나 혹은 조건없이 모여들어 아직 정제되지않은 불필요한 정보가 섞인 커다란 규모의 정보

데이터베이스 = '정보' 를 모아놓은 저장소 / 기본적으로 사용자가 사용하기좋게 구성되어있다. 막연히 인터넷에서 맘에드는 페이지를 북마크해놓는거와는 다르고, 여기에도 기준이 있다.

DBMS (data base management system) = 데이터베이스를 더 잘 관리하고 편하게 사용할수있도록 도와주는 시스템  
> - 실제로 많은 회사들이 사용하고있고
> - 비교를하자면.. 컴퓨터에 디렉토리,파일관리시스템도 하나의 데이터베이스이다. 하지만 관리하기란 쉽지않다.
> - 이전에 사용했던 mongoDB나, Mysql를 생각해보면 데이터를 항상 특정 경로로 접근해서만 사용할수있었다.
> - 그 데이터베이스를 제어하기 위한 언어가 SQL이 되겠다.

### 이중에서 현재는 RDBMS가 가장 많이 사용된다.

relational database management system

관계형 데이터베이스 관리 시스템 되시겠다.

관계형? 뭐가 뭔지모르겠지만

쉽게생각해서 까다로운 녀석이라고보면된다.

나를 사용하려면 어마무시한 규칙속에서 사용해야할꺼야.

![](https://www.fun-coding.org/00_Images/db_types.png)

여기서 보면 상위구간에 RDBMS로 가득한게 보일것이다.  
(2017년 기준이긴하지만 물론 변화는있다. Nosql이나 혹은 Nosql과 rdbms가 약간 섞인 새로운 것들도 등장하고있다.)

그만큼 많이 사용되고 까다롭지만 에러나 치명적인 문제를 일으킬 가능성이 낮아서 좋다.

(대신 에러나 치명적인 문제는 서비스 할때의 얘기이고 그전에 설계와 디버그단계에서 많이 애를 먹을꺼같다.)

나는 데이터베이스공부를하면서

릴레이션이라던가 속성, 튜플 등등

키의 6가지 종류 등등

많은것을 배웠지만 아직 완전한 단계는 아니다.

이번에 데이터베이스의 중요함을 느끼고 학교수업으로 배운내용도 정리해서 되새김하는것도 좋을꺼같다.


---

각 필드의 데이터형
1. CHAR(10) : 10칸을 꽉 채워준다 여백으로 당연히 max도 10이다.
2. VARCHAR(10) : max가 10칸임을 알려준다.
3. TEXT : 많은 양의 문자
4. INT : 음수 혹은 양수 모든숫자 (정수)
5. FLOAT,DOUBLE : 소수점을 가진 숫자(가질수있는 숫자 실수형자료)  
등등 더있다.


## primary key (기본키)

> 각 개체의 고유 인식자

이름은 동명이인이 있을수있고, 같은 주소에 살수도 있고 등등

그래서 학번? 겹치는일이 없다.

주로 통상적으로 , id field라는것을 하나 생성해놓고,
추가될때마다 id가 생성되는것이다.

선택된 속성은 고유하고, 변경되지 않고, 언제나 존재하는(절대 빈값이나 NULL이 아닌) 상태여야한다.

---

- 고객정보
    - 이름 - 문자열 VARCHAR(20)
    - 이메일 - 문자열 VARCHAR(100)
    - 비밀번호 - 문자열 VARCHAR(20)
    - 회원가입일 - Datetime DATETIME
    - 내가 쓴 게시글들 - ???
    - 나를 팔로워하는 유저들 - ???
    - 내가 팔로잉하는 유저들 - ???

관계를 설정해보자.

## 1:1 관계

붙여서 구성해도되는데 왜 나눠서 쓰는가?

이유?

인스타그램에서 유저테이블과 프로필테이블이 있는데 여기는 1:1 관계라서
합쳐벼려도 된다 하지만 나누어놓았다. 이유는

대부분의 유저들이 프로필사진과 디스크립션을 설정을 안했다.

그런데 나눠놓지앟고 하나의 테이블로 구성하면 데이터 낭비가 심하다.

대부분이 빈값이면 충분히 나누는것을 고려해보는게 좋다. 데이터 절약

테이블을 하나 더 분리함으로 써 데이터를 효과적으로 저장한다.

(크게 사용할일이 많지는않다. 흔치않는 케이스 ,주로 대부분이 위에와 비슷한 용도)

## 1:N 관계

유저와 게시글과의 관계 외래키 사용하고

foreign key (외래키)

유저가 글을 썻는데

포스트 데이터베이스에서 유저의 id를 외래키로 사용함으로써

1:N의 관계가 성립

foreign key 는 다른 테이블에서 primary key인 것을

대리고와서 하나의 관계를 이어주는 다리역할? 이렇게 생각하면 될꺼같다.
___

키의 5가지 종류를 잠깐 언급해야할꺼같아서 잠깐 정리하면

1. 후보키(candidate key)
    - 각 튜플을 유일하게 식별할 수 있는 속성이나 속성의 집합
    - 후보키의 조건은 유일성과 최소성을 모두 만족해야함

    > 유일성 : 하나의 키로 어떠한 행을 바로 찾아낼수있는 능력 (예:학번,주민번호)  
    > 최소성 : 꼭 필요한 속성들로만 구성해야한다. (학번으로만 구성해도되는데 , 주민번호까지? 가져갈 필요가없는것이다.)
2. 기본키(primary key)
    - 후보키 중에서 튜플을 식별하기 위해 특별히 선택된 키
    - 중복될수없고, NULL값이 올수없음
    - 유일성과 최소성을 만족해야함 (후보키와 동일)
3. 대체키(alternate key)
    - 후보키 중에서 기본키를 제외한 속성 (한마디로 언제라도 대체될수있을법한 애들)
4. 외래키(foreign key)
    - 다른 테이블을 참조하기 위해 사용되는 속성
5. 슈퍼키(super key)
    - 후보키와 다른 속성들과의 모든 조합

![](https://hyeonukdev.github.io/images/%EC%A0%95%EB%B3%B4%EC%B2%98%EB%A6%AC%EA%B8%B0%EC%82%AC/0517_01.png)

벤다이어그램으로보면 조금더 이해가 잘간다.

추가로 공부하면 좋을것, 무결성제약조건 << 

___

## M:N 관계 (특수한 케이스)

한 테이블의 복수의 레코드가 다른 테이블의 복수의 레코드와 관계가 있을때 발생한다


인스타의 팔로워 팔로잉 관계에서 발생할수 있다.

A유저는 여러명의 유저를 팔로잉할수있고, A유저는 여러명의 유저로부터 팔로잉을 당할수있다.

하나의 테이블만으로는 팔로워와 팔로잉은 표현해낼수가 없다

follower이라는 테이블을 만들어서 사용한다 (중간에 mapping해주는 중간다리 역할)

중간다리 테이블을 __교차테이블__ 이라고한다.

---

db설계에 정답은 없지만.

효율적으로 저장하면 시간이 걸리고 , 대신에 나중에 검색할때 빠르고 용이할수있다.

빠르게 저장하면 효율적이지 않을수있다.


1:N , N:M 이런것을 중점으로 데이터를 설계하는것을 본것은 처음이였다

처음엔 ER벤다이어그램인가? 그거로 봐보려고했다가

나중엔 표현하는방법중에 새발 삼지창모양으로 표현하는 그림도 있던거같다.

개인적으로 db설계가 제일 어려운거같다..

![](https://github.com/gatsukichi/TWIL/blob/develop/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-10-03%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2012.52.59.png?raw=true)

설계하기 나름인것도 많이보였다.

나도 설계하면서 order는 product와 user를 잇는 속성으로 생각하고 마름모로 그리고 막이렇게 하려고했던거같다..

오히려 타원, 이중타원, 마름모, 그리고 밑줄.. 이런식으로 설계하는줄 알앗던것도 있다.


하여튼 설계는 어렵다.

간단하더라도 자주쓰이는? 게시판을 데이터설계를 해보는게 좋을꺼같다.

___

### 과제 리뷰

JS끝내고 React / this structure? , 해체할당? 안듣고  
레스트파라미터, 디폴트파라미터 등등..  
오류없이 잘 다루게 해주는 것  
reduce 굳이 포문 안돌리고 간단한 코드로.. 등등

리액트에서 린트,프리티어 vscode 

npx.. <? 이상한데>

설정안했는데 저장하면 자꾸 바뀐다. (얀? 야믈?도 할수있다?..)

JS패키지 / npm , yarn (python=pip 하나 쓴다)
npm : microsoft
yarn : facebook

어떤걸 써도 괜찮지만 프로젝트에서 쓸때는 섞지말고 하나만 써야한다.

에로우펑션 한번 볼것

> 임호준님 리뷰

---

리액트 셋업 방법

바벨? : 모든 부라우저들이 모든 ES버전을 지원하는게 아니기때문에 다른 버전의....??  
        쉽게 생각하면 호환맞춰주는 친구라고 생각하면될꺼같다.

네이밍 할때 camel case를 사용한다. 통상

리액트를 아직 입문하지않아서 .. 이해를 못하겟다. 근데 대부분이 컴포넌트였다.

구조화 할당 (api에서 값 꺼내서 쓰듯이. 해봐야한다.)

class component 요즘 안쓰니까 만약 강의듣다가 나오면 hooks로 건너뛸것



> 안정현님 리뷰

___

반복문 , 3항연산자 ( 조건문 ) , 리액트라서 조건문을 쓰는경우가 많다.

> 이재우님

___

강의가 생각보다 친절하지않다.

JS 너무 어려웠다. 나도 생각하기에 하나를 듣는데

검색하는시간이 더 길었다.

즉시실행 ,애로우 둘다 나도 어려웠습니다.

ES6 문법은 거의다 곧 끝난다. rest , 비구조 할당

너무 고민하지말것, (나중에 면접때나 나올법한 디테일한것들이고)

빠르게 하고 리액트로 넘어가는것을 추천.

내가생각해도 es6문법에 시간이 너무 지체되고있는거같다

빨리끝내야겠다.


> 지윤님


___

장고 , 모델 , OOP 다시 공부

자바에서 말하는 클래스다  (모델)

엑셀에서 표현했던 빵, 빵틀(장고모델)

그럼 빵틀에 찍혀서 나오는 빵은 장고에서 어떤거랑 매칭될까?? 인스턴스?

상속 개념이 나오는구나..

리액트 extens << 이것도 상속이다. 자바에서 나왔던거같다 기억이날꺼같기도..

익스텐즈 말고 하나 더있엇는데 뭐였지 abstract? 아 뭐였지..

장고에 이미 있는 모델의 기능이 있는데

그거에 post를 만들어서 상속시켜서 내가 기능을 확장시켜서 사용하는것이다.

마이그레이션 배워야 db를 할수있다.

장고도 재밌고 어려워보인다 ..

장고 모델 vs ORM ?

db에 데이터를 저장하려면  
SQL이라는것을 날려야함.

python에서는 DJANGO ORM 이라는 친구가 나온것이다.
Post.objects.create(title="hello",content="world")

이게 sql로 바뀐다.

일단 테이블생성, 그리고 데이터삽입,서치,셀렉트 등등 다해준다.
pymongo 쓸때도 sql을 1도 사용하지 않았었으니 비슷한 기능이 탑재된거같다.

아, 모델을 기반으로 실행되서 조금 헷갈릴수있다.

>나리님

___

### 전체적인 리뷰

- 바벨

옜날브라우저는 이해를 못한다. i7 이런것들.. es6등등 상위 문법을 이해못한다
그래서 

옛날 문법으로 바꿔주는것. 트랜스파일러의 역할이다.

- 웹팩

파일을 엄청 많이 만들어놓는다 , 모듈을 엄청 많이 만들어놓는다면 

네이버라고 치면 , 수많은 자바스크립트 파일을 불러오면

네트워크 비용이 엄청 든다. 파일이많아서.

최적의 압축된 형태로받아오는게, 번들러라고 한다. 흩어져있는 많은파일을 하나로 만들어준다.

> 신경을 안써도 되는데 리액트 스타트할때 npx로 시작하면 걔가 알아서 다해주기 때문에

facebook npx.create.React.app 이건가. 그렇다....여튼

페이지를 처음들어갈때 처음으로 커넥션을 맺을때 네트워크 비용이 제일 많이 발생한다.


- 리액트가 렌더링이 새롭게 되는경우 크게 4가지

    1. 컴포넌트가 새로운 props 를 받으면

    2. states라는 친구가 업데이트 되어도.

    3. 컨텍스트 (데이터를 한군데에서 관리하는) 업데이트되면

    4. 내가 자식 컴포넌트일때 , 부모 컴포넌트가 랜더링이되면, 자동으로 자식컴포넌트도 랜더링이된다.

    이 4가지는 외워두는게 좋다.
    (가끔 무한랜더링? 에 걸릴때가 있다. 이때 해결해야한다.)



- 마지막 arrow function ,map, filter


스프레드 연산자 

```js
const newUsers = [...users, updateUser]
```

삭제할때? filter 라는 친구가있다.

```js
users.filter(user => users.id === id ? null : user)
```

마지막에 리스트로 하나를 담아서 리턴해준다. (리턴만 해주는거지 원본은 바뀌지않는다.)

map도 한바퀴 돈다.

```js
const updateUser = {
    {id:4,name:'사울', username:'saul'}
}
users = users.map(user => (user.id === updateUser.id)? updateUser : user)
```